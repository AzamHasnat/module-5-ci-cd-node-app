deploy:
  name: Deploy to Self-Hosted Runner (Windows)
  needs: test
  runs-on: self-hosted

  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Download test results
      uses: actions/download-artifact@v4
      with:
        name: test-results

    - name: Display test results
      run: type test-results.txt

    - name: Install dependencies
      run: npm install

    - name: Deploy Application
      shell: pwsh
      run: |
        Write-Host "Starting application..."
        pm2 stop app; if ($LASTEXITCODE -ne 0) { Write-Host "App not running, skipping stop" }
        pm2 start index.js --name app
